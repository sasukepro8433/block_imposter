<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Block Impostors</title>
<link rel="shortcut icon" href="logo.png" type="image/x-icon">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

  body {
    margin: 0;
    background-color: #0b0b0b;
    font-family: 'Press Start 2P', cursive;
    color: white;
    overflow: hidden;
  }

  #menu {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #1c1c1c;
    border: 4px solid #555;
    padding: 30px 60px;
    text-align: center;
    box-shadow: 0 0 15px #3af;
    z-index: 10;
    width: 320px;
    user-select: none;
  }

  #menu h1 {
    margin: 0 0 30px 0;
    font-size: 32px;
    color: #3af;
    text-shadow: 2px 2px 0 #000;
  }

  #menu button {
    display: block;
    width: 100%;
    background: #2a2a2a;
    border: 3px solid #3af;
    color: #3af;
    font-size: 14px;
    padding: 15px 0;
    margin: 10px 0;
    cursor: pointer;
    letter-spacing: 1px;
    text-shadow: 1px 1px 0 #000;
  }

  #menu input {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
    font-family: 'Press Start 2P', cursive;
    font-size: 12px;
    text-align: center;
  }

  #discordLogin {
    background: #5865F2;
    border: 3px solid #99aab5;
    color: white;
  }

  canvas {
    display: block;
    margin: 0 auto;
    background-color: #333;
    border: 3px solid #555;
    position: relative;
    z-index: 1;
  }

  #argentCounter, #boutique {
    font-size: 12px;
    z-index: 20;
    color: #3af;
    background: #111;
    border: 2px solid #3af;
    padding: 10px;
  }

  #boutique {
    display: none;
    position: fixed;
    top: 20px;
    right: 20px;
    width: 260px;
  }

  #boutique .item {
    margin: 10px 0;
    background: #222;
    padding: 10px;
    border: 1px solid #555;
  }

  #boutique .item button {
    float: right;
    background: #3af;
    border: none;
    color: #000;
    font-size: 10px;
    padding: 5px 8px;
    cursor: pointer;
  }
</style>
</head>
<body>
<div id="menu">
  <h1>Block Impostors</h1>
  <input id="skinCodeInput" placeholder="Code de skin...">
  <button onclick="verifierCode()">Valider</button>
  <button id="startBtn">Jouer</button>
  <button id="optionsBtn">Options</button>
  <button id="shopBtn">Boutique</button>
  <button id="discordLogin">Connexion Discord</button>
  <button id="quitBtn">Quitter</button>
  <div id="userInfo"></div>
</div>

<div id="argentCounter">💰 Pièces : <span id="argentValeur">1000</span></div>
<div id="boutique">
  <h2>Boutique</h2>
  <div class="item">👕 Skin Daquavis — Gratuit <button onclick="acheterItem(0)">Acheter</button></div>
  <div class="item">🦸 Skin Susy — 200 pièces <button onclick="acheterItem(200)">Acheter</button></div>
  <div class="item">🎩 Chapeau Ultra — 500 pièces <button onclick="acheterItem(500, 'chapeau-ultra.png')">Acheter</button></div>
  <div class="item">🤠 Chapeau Cowboy — 45 € <button onclick="acheterItem(-1)">Acheter</button></div>
</div>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const player = {
  x: 100,
  y: 100,
  speed: 3,
  image: new Image(),
  hatImage: null
};

const keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

function movePlayer() {
  if (keys["ArrowUp"] || keys["z"]) player.y -= player.speed;
  if (keys["ArrowDown"] || keys["s"]) player.y += player.speed;
  if (keys["ArrowLeft"] || keys["q"]) player.x -= player.speed;
  if (keys["ArrowRight"] || keys["d"]) player.x += player.speed;
}

function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  movePlayer();
  ctx.drawImage(player.image, player.x, player.y, 48, 64);
  if (player.hatImage) ctx.drawImage(player.hatImage, player.x, player.y - 32, 48, 32);
  requestAnimationFrame(gameLoop);
}

const skinSauvegarde = localStorage.getItem("skinActuel");
if (skinSauvegarde) player.image.src = skinSauvegarde;
else player.image.src = "daquavis.png";

const chapeauSauvegarde = localStorage.getItem("chapeauActuel");
if (chapeauSauvegarde) {
  player.hatImage = new Image();
  player.hatImage.src = chapeauSauvegarde;
}

gameLoop();

function verifierCode() {
  const code = document.getElementById("skinCodeInput").value.trim().toLowerCase();
  const codesSkins = {
    "bird orange": "devlopeur.png",
    "1234": "daquavis.png",
    "12345": "DREAM.png"
  };

  if (code === "ttt") {
    const chapeauDev = new Image();
    chapeauDev.src = "ordi de dev chapeau.png";
    player.hatImage = chapeauDev;
    localStorage.setItem("chapeauActuel", "chapeau-dev.png");
    alert("🎩 Chapeau développeur activé !");
    return;
  }

  if (codesSkins[code]) {
    player.image.src = codesSkins[code];
    localStorage.setItem("skinActuel", codesSkins[code]);
    alert("✅ Skin activé !");
  } else {
    alert("❌ Code inconnu.");
  }
}

const menu = document.getElementById('menu');
const startBtn = document.getElementById('startBtn');
const shopBtn = document.getElementById('shopBtn');
const quitBtn = document.getElementById('quitBtn');
const boutique = document.getElementById('boutique');

startBtn.onclick = () => menu.style.display = 'none';
shopBtn.onclick = () => boutique.style.display = boutique.style.display === 'none' ? 'block' : 'none';
quitBtn.onclick = () => alert("Merci d'avoir joué !");

document.getElementById("discordLogin").onclick = () => {
  const clientId = "1381020944994144286";
  const redirectUri = window.location.origin + window.location.pathname;
  const oauthUrl = `https://discord.com/api/oauth2/authorize?client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&response_type=token&scope=identify`;
  window.location.href = oauthUrl;
};

let argent = 1000;
function majArgent() {
  document.getElementById("argentValeur").textContent = argent;
}

function acheterItem(prix, chapeauPath) {
  if (prix === -1) {
    alert("Cet objet doit être acheté en dehors du jeu.");
    return;
  }
  if (argent >= prix) {
    argent -= prix;
    majArgent();
    alert("Achat effectué !");
    if (chapeauPath) {
      player.hatImage = new Image();
      player.hatImage.src = chapeauPath;
      localStorage.setItem("chapeauActuel", chapeauPath);
    }
  } else {
    alert("Pas assez de pièces !");
  }
}

majArgent();
</script>
</body>
</html>

